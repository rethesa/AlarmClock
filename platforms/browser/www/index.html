<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <meta name="format-detection" content="telephone=yes" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <title>Alarm Clock</title>
     <link rel="stylesheet" type="text/css" href="css/index.css">
     <script src="jquery-3.3.1.min.js"></script>
</head>

<body>
    <h1>Alarm Clock</h1>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>

    <button id="addAlarmBtn"> + new Alarm</button>
    <input id="timeInput" style="width: 0px; height:0px; padding:0px; margin:0px" type="time" value="07:30"/>
    <br>

    <div class="alarms" id="alarms">
        <div class="alarm" id="alarm1">
            <div class="timewrapper" id="timewrapper1">
                07:45
            </div>
            <div class="checkboxwrapper" id="checkboxwrapper1">
                <input type="checkbox" id="alarmChecked1" onclick="setAlarmCheckbox(1, '07:00' )" >
            </div>
            <div class="modewrapper" id="modewrapper1">
                <button id="chooseAlarmMode1"> V </button>
            </div>
            <div class="deletewrapper" id="deletewrapper1">
                <button id="deleteAlarmBtn1" onclick="deleteAlarm(1)"> X </button>
            </div>
        </div>
        <!--<div class="alarm" id="dummyAlarm">    
        </div>-->   
    </div>

    <script>
    var id = 2;
    var timeValue = 0;

    document.getElementById("addAlarmBtn").onclick = function() {
                  $("#timeInput").click();
    }

    document.getElementById("timeInput").oninput = function(){
      timeValue = document.getElementById("timeInput").value;
      addAlarm(timeValue.toString());
    }

    function addAlarm(time) {
        console.log("call addAlarm time= " + time + " id =" + id);
        if(time != "") {
            
            var timewrapperID = "timewrapper" + id;
            var checkboxwrapperID = "checkboxwrapper" + id;
            var modewrapperID = "modewrapper" + id;
            var deletewrapperID = "deletewrapper" + id;
            var alarmCheckedID = "alarmChecked" + id;
            var chooseAlarmModeID = "chooseAlarmMode" + id;
            var deleteAlarmBtnID = "deleteAlarmBtn" + id;

            var timestr = "'" + time + "'";

            var newTime = '<div class="timewrapper" id="' + timewrapperID + '">' + time + '</div>';
            var newCheckbox = '<div class="checkboxwrapper" id="' + checkboxwrapperID + '"><input type="checkbox" id="' + alarmCheckedID + '" onclick="setAlarmCheckbox(' + id + ', ' +  timestr + ')"></div>';
            var newMode = '<div class="modewrapper" id="' + modewrapperID + '"><button id="' + chooseAlarmModeID + '"> V </button></div>';
            var newDelete = '<div class="deletewrapper" id="' + deletewrapperID + '"><button id="' + deleteAlarmBtnID + '" onclick="deleteAlarm(' + id + ')"> X </button></div>';
            
            console.log("aaa");
            var boxes = [id];
            //wenn alarm Ã¼berhaupt noch existiert
            console.log("bbb");
            for (j = 1;j < id; j++) {
    	        boxes[j] = document.getElementById("alarmChecked" + j).checked;
            }
            console.log("ccc");
            document.getElementById("alarms").innerHTML += '<div class="alarm" id="alarm' + id + '">' + newTime + newCheckbox + newMode + newDelete + '</div>';
            console.log("ddd")
            for (j = 1;j < id; j++) {
    	        document.getElementById("alarmChecked" + j).checked = boxes[j];
            }
            console.log("after");

            /*
            var dummy = document.getElementById("dummyAlarm");
            dummy.id = "alarm" + id;
            dummy.innerHTML = '</div>' + newTime + newCheckbox + newMode + newDelete + '<div id="dummyAlarm"></div>';
            console.log("eee");*/

            id++;
        }
    }

    function deleteAlarm(id) {
        console.log("call deleteAlarm " + id);
        var alarm = document.getElementById("alarm"+id);
        alarm.innerHTML = null;
    }

    function setAlarmCheckbox(id, time) {
        console.log("call setAlarmCheckbox, id= " + id  + " time " + time);
        var checkbox = document.getElementById("alarmChecked"+id);
        console.log("test");
        console.log("checkbox.checked = " + checkbox.checked);
        if (checkbox.checked == true){
            console.log("checkbox is set");
            //TODO set alarm for vibration --> when time == alarm time

            //user output
            var res = time.split(":");
            var alarmHours = parseInt(res[0]);
            var alarmMinutes = parseInt(res[1]);
            var date = new Date();
            alert("Alarm will ring in " + getTimeToAlamr(alarmHours, date.getHours(), alarmMinutes, date.getMinutes()) );
        } else {
            console.log("checkbox is unset");
            //TODO unset alarm
        }
    }

    function getTimeToAlamr(alarmHours, actualHours, alarmMinutes, actualMinutes) {
        var min;
        var hour;
        if(alarmMinutes >= actualMinutes) {
            min = alarmMinutes - actualMinutes;
            if (alarmHours >= actualHours) {
                hour = alarmHours - actualHours;
            } else {
                hour = 24 - (actualHours -  alarmHours);
            }
        } else {
            min = 60 - (actualMinutes - alarmMinutes);
            if (alarmHours > actualHours) {
                hour = alarmHours - actualHours - 1;
            } else {
                hour = 24 - (actualHours -  alarmHours) - 1;
            }
        }
        return "Alarm rings in " + hour + " hours and " + min + " minutes.";
    }

</script>
</body>

</html>



<!--<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
    <meta name="format-detection" content="telephone=yes" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"
    />
    <title>12Swipese</title>
    <style type="text/css">
    </style>
</head>

<body>
    Hello World
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script>
    </script>
</body>

</html> 

<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Alarm Clock</title>
        <link rel="stylesheet" type="text/css" href="css/index.css" />
    </head>
    <body>
        <script src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>

        <h1>Alarm Clock</h1>

        <div data-role="content" class="ui-content">
            <button class="ui-btn ui-shadow" onclick="scanAndConnect();">Scan and Connect</button> 
        </div>

    </body>
</html>-->

